---
import { getCollection } from 'astro:content'
import BaseLayout from '../layouts/BaseLayout.astro'
import PostList from '../components/PostList.astro'
import Pagination from '../components/Pagination.astro'
import { loadSite, paginate } from '../lib/site'

const site = loadSite()

const posts = await getCollection('posts')

const allPosts = posts
  .map(post => ({
    slug: post.id,
    url: `/posts/${post.id}/`,
    title: post.data.title,
    date: post.data.date,
    description: post.data.description,
    tags: post.data.tags,
    section: 'posts'
  }))
  .sort((a, b) => b.date.getTime() - a.date.getTime())

const { items: paginatedPosts, totalPages } = paginate(allPosts, site.pagination, 1)
---

<BaseLayout>
  <div class="container">
    <section class="mb-12">
      <h1 class="text-3xl font-bold mb-4">Welcome</h1>
      <p class="text-gray-600 leading-relaxed">
        {site.description}
      </p>
    </section>

    <section>
      <h2 class="text-2xl font-semibold mb-6">Recent Posts</h2>
      <PostList posts={paginatedPosts} />
      <Pagination currentPage={1} totalPages={totalPages} baseUrl="/" />
    </section>
  </div>
</BaseLayout>
