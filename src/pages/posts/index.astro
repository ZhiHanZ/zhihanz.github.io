---
import { getCollection } from 'astro:content'
import BaseLayout from '../../layouts/BaseLayout.astro'
import PostList from '../../components/PostList.astro'
import Pagination from '../../components/Pagination.astro'
import { loadSite, paginate } from '../../lib/site'

const site = loadSite()
const posts = await getCollection('posts')

const allPosts = posts
  .map(post => ({
    slug: post.id,
    url: `/posts/${post.id}/`,
    title: post.data.title,
    date: post.data.date,
    description: post.data.description,
    tags: post.data.tags,
    section: 'posts' as const
  }))
  .sort((a, b) => b.date.getTime() - a.date.getTime())

const { items: paginatedPosts, totalPages } = paginate(allPosts, site.pagination, 1)
---

<BaseLayout title="Posts" description="Technical articles on GenAI, data infrastructure, and systems programming">
  <div class="container">
    <h1 class="text-3xl font-bold mb-6">Posts</h1>
    <p class="text-gray-600 dark:text-gray-400 mb-8">
      Deep dives into GenAI, agentic workflows, data infrastructure, and systems programming.
    </p>
    {allPosts.length > 0 ? (
      <>
        <PostList posts={paginatedPosts} />
        <Pagination currentPage={1} totalPages={totalPages} baseUrl="/posts/" />
      </>
    ) : (
      <p class="text-gray-500">No posts yet. Check back soon!</p>
    )}
  </div>
</BaseLayout>
