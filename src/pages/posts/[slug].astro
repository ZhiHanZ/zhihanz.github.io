---
import { getCollection, render } from 'astro:content'
import BaseLayout from '../../layouts/BaseLayout.astro'
import Giscus from '../../components/Giscus.astro'
import { formatDate, loadSite } from '../../lib/site'

export async function getStaticPaths() {
  const posts = await getCollection('posts')
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post }
  }))
}

const site = loadSite()
const { post } = Astro.props
const { Content } = await render(post)
const { full: publishedAt } = formatDate(post.data.date)
const postUrl = `${site.baseURL}/posts/${post.id}/`
const shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(post.data.title)}&url=${encodeURIComponent(postUrl)}`
---

<BaseLayout title={post.data.title} description={post.data.description} image={post.data.image}>
  <article class="container">
    <header class="pb-4 mb-8 border-b border-gray-200 dark:border-gray-700">
      <div class="flex justify-between items-start">
        <h1 class="text-3xl font-bold mb-2">{post.data.title}</h1>
        <a
          href={shareUrl}
          target="_blank"
          rel="noopener noreferrer"
          class="text-gray-400 hover:text-[--color-accent] transition-colors p-1"
          aria-label="Share this post"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/>
          </svg>
        </a>
      </div>
      <div class="text-sm text-gray-600 dark:text-gray-400">
        <time datetime={post.data.date.toISOString()}>{publishedAt}</time>
      </div>
      {post.data.tags.length > 0 && (
        <div class="flex flex-wrap gap-2 mt-3">
          {post.data.tags.map((tag) => (
            <a href={`/tags/${tag}/`} class="tag">{tag}</a>
          ))}
        </div>
      )}
    </header>

    <div class="prose">
      <Content />
    </div>

    <hr class="border-gray-200 dark:border-gray-700 mt-10 mb-4" />
    <Giscus />
  </article>
</BaseLayout>
